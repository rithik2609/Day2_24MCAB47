<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <meta charset="UTF-8">
  <title>Course Registration</title>

  <style>
    /* Original CSS for other pages (unchanged) */
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    body {
        background: #ffffff;
        min-height: 100vh;
        color: #2c3e50;
    }

    .hidden {
        display: none !important;
    }

    /* Top Navigation Bar */
    .top-navbar {
        background: #ffffff;
        border-bottom: 1px solid #e0e0e0;
        padding: 15px 25px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        z-index: 1000;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .logo {
        font-size: 24px;
        font-weight: 700;
        color: #2c3e50;
    }

    .user-section {
        display: flex;
        align-items: center;
        gap: 20px;
    }

    #welcomeUser {
        font-size: 16px;
        font-weight: 600;
        color: #2c3e50;
    }

    .logout-btn {
        background: #f1c40f;
        color: #2c3e50;
        border: none;
        padding: 8px 16px;
        border-radius: 6px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.2s ease;
    }

    .logout-btn:hover {
        background: #f39c12;
        transform: translateY(-1px);
    }

    /* Main Layout */
    .main-container {
        display: flex;
        margin-top: 70px;
        min-height: calc(100vh - 70px);
    }

    /* Sidebar */
    .sidebar {
        width: 280px;
        background: #f8f9fa;
        border-right: 1px solid #e0e0e0;
        padding: 20px 0;
        position: fixed;
        left: 0;
        top: 70px;
        bottom: 0;
        overflow-y: auto;
    }

    .sidebar-section {
        padding: 0 20px;
        margin-bottom: 30px;
    }

    .sidebar-title {
        font-size: 14px;
        font-weight: 600;
        color: #6c757d;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 15px;
    }

    .sidebar-item {
        display: flex;
        align-items: center;
        padding: 12px 15px;
        margin-bottom: 5px;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.2s ease;
        font-weight: 500;
        color: #2c3e50;
    }

    .sidebar-item:hover {
        background: #e9ecef;
    }

    .sidebar-item.active {
        background: #f1c40f;
        color: #2c3e50;
        font-weight: 600;
    }

    .sidebar-item-icon {
        margin-right: 12px;
        font-size: 16px;
    }

    /* Content Area */
    .content-area {
        margin-left: 280px;
        flex: 1;
        padding: 30px;
        background: #ffffff;
    }

    .content-header {
        margin-bottom: 30px;
    }

    .content-title {
        font-size: 32px;
        font-weight: 700;
        color: #2c3e50;
        margin-bottom: 10px;
    }

    .content-subtitle {
        font-size: 16px;
        color: #6c757d;
    }

    /* Course Cards */
    .course-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
        gap: 25px;
        margin-top: 20px;
    }

    .course-card {
        background: #ffffff;
        border: 1px solid #e0e0e0;
        border-radius: 12px;
        padding: 25px;
        transition: all 0.2s ease;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }

    .course-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        border-color: #f1c40f;
    }

    .course-code {
        font-size: 18px;
        font-weight: 700;
        color: #2c3e50;
        margin-bottom: 8px;
    }

    .course-name {
        font-size: 16px;
        color: #495057;
        margin-bottom: 15px;
        font-weight: 600;
    }

    .course-description {
        font-size: 14px;
        color: #6c757d;
        margin-bottom: 20px;
        line-height: 1.6;
    }

    .seats-info {
        display: flex;
        align-items: center;
        margin-bottom: 20px;
        padding: 12px;
        background: #f8f9fa;
        border-radius: 8px;
        border-left: 4px solid #f1c40f;
    }

    .seats-available {
        font-weight: 600;
        color: #28a745;
    }

    .seats-full {
        color: #dc3545;
        font-weight: 600;
    }

    .course-button {
        width: 100%;
        padding: 12px;
        border: none;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s ease;
    }

    .course-button.available {
        background: #f1c40f;
        color: #2c3e50;
    }

    .course-button.available:hover {
        background: #f39c12;
        transform: translateY(-1px);
    }

    .course-button.unavailable {
        background: #e9ecef;
        color: #6c757d;
        cursor: not-allowed;
    }

    .empty-state {
        text-align: center;
        padding: 60px 20px;
        color: #6c757d;
    }

    .empty-state h3 {
        font-size: 24px;
        margin-bottom: 10px;
        color: #495057;
    }

    .enrolled-badge {
        text-align: center;
        padding: 12px;
        background: #d4edda;
        border: 1px solid #c3e6cb;
        border-radius: 8px;
        color: #155724;
        font-weight: 600;
    }

    /* Admin Specific Styles */
    .admin-dashboard {
        display: grid;
        grid-template-columns: 1fr;
        gap: 30px;
    }

    .admin-section {
        background: #ffffff;
        border: 1px solid #e0e0e0;
        border-radius: 12px;
        padding: 25px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }

    .admin-section-title {
        font-size: 24px;
        font-weight: 700;
        color: #2c3e50;
        margin-bottom: 20px;
        padding-bottom: 10px;
        border-bottom: 1px solid #e0e0e0;
    }

    .admin-form {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-bottom: 20px;
    }

    .admin-form .form-group {
        margin-bottom: 0;
    }

    .admin-form-button {
        grid-column: span 2;
    }

    .user-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
    }

    .user-table th, .user-table td {
        padding: 12px 15px;
        text-align: left;
        border-bottom: 1px solid #e0e0e0;
    }

    .user-table th {
        background-color: #f8f9fa;
        font-weight: 600;
    }

    .user-table tr:hover {
        background-color: #f8f9fa;
    }

    .action-button {
        padding: 6px 12px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-weight: 500;
        transition: all 0.2s ease;
    }

    .action-button.delete {
        background-color: #dc3545;
        color: white;
    }

    .action-button.delete:hover {
        background-color: #c82333;
    }

    .action-button.view {
        background-color: #17a2b8;
        color: white;
        margin-right: 5px;
    }

    .action-button.view:hover {
        background-color: #138496;
    }

    /* Loading Animation */
    .loading {
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 2px solid #e0e0e0;
        border-top: 2px solid #f1c40f;
        border-radius: 50%;
        animation: spin 1s linear infinite;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    /* Responsive Design */
    @media (max-width: 768px) {
        .sidebar {
            width: 100%;
            position: relative;
            top: 0;
            height: auto;
        }

        .content-area {
            margin-left: 0;
        }

        .main-container {
            flex-direction: column;
        }

        .course-grid {
            grid-template-columns: 1fr;
        }

        .admin-form {
            grid-template-columns: 1fr;
        }

        .admin-form-button {
            grid-column: span 1;
        }
    }

    /* NEW LOGIN PAGE DESIGN (only this section changed) */
    .auth-container {
        display: flex;
        min-height: 100vh;
        background: #f8fafc;
    }

    .hero-section {
        flex: 1;
        background: linear-gradient(135deg, #4f46e5, #7c3aed);
        padding: 5rem;
        display: flex;
        flex-direction: column;
        justify-content: center;
        color: white;
        position: relative;
        overflow: hidden;
    }

    .hero-section::before {
        content: '';
        position: absolute;
        top: -50%;
        right: -50%;
        width: 100%;
        height: 200%;
        background: radial-gradient(circle, rgba(255,255,255,0.15) 0%, transparent 70%);
    }

    .hero-content {
        position: relative;
        z-index: 2;
        max-width: 600px;
    }

    .hero-title {
        font-size: 3rem;
        font-weight: 700;
        margin-bottom: 1.5rem;
        line-height: 1.2;
    }

    .hero-subtitle {
        font-size: 1.1rem;
        line-height: 1.7;
        margin-bottom: 2.5rem;
        opacity: 0.9;
        font-weight: 400;
    }

    .features {
        margin-top: 2rem;
    }

    .feature-item {
        display: flex;
        align-items: center;
        margin-bottom: 1.5rem;
    }

    .feature-icon {
        width: 48px;
        height: 48px;
        background: rgba(255, 255, 255, 0.15);
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 1.5rem;
        font-size: 1.2rem;
    }

    .feature-text {
        font-size: 1rem;
        font-weight: 500;
    }

    .forms-section {
        flex: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 2rem;
    }

    .form-container {
        width: 100%;
        max-width: 420px;
    }

    .form-card {
        background: white;
        border-radius: 16px;
        padding: 2.5rem;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.05);
    }

    .form-title {
        text-align: center;
        margin-bottom: 2rem;
        color: #1e293b;
        font-size: 1.8rem;
        font-weight: 600;
    }

    .form-subtitle {
        text-align: center;
        color: #64748b;
        margin-bottom: 2rem;
        font-size: 0.95rem;
    }

    .login-type-toggle {
        display: flex;
        margin-bottom: 1.5rem;
        background: #f1f5f9;
        border-radius: 10px;
        padding: 6px;
    }

    .login-type-btn {
        flex: 1;
        padding: 0.75rem;
        text-align: center;
        cursor: pointer;
        font-weight: 500;
        border-radius: 8px;
        transition: all 0.3s ease;
        color: #64748b;
    }

    .login-type-btn.active {
        background: white;
        color: #4f46e5;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .form-group {
        margin-bottom: 1.5rem;
    }

    .form-label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: 500;
        color: #1e293b;
        font-size: 0.95rem;
    }

    .form-input {
        width: 100%;
        padding: 0.875rem 1rem;
        border: 1px solid #e2e8f0;
        border-radius: 10px;
        font-size: 1rem;
        transition: all 0.3s ease;
        background-color: white;
    }

    .form-input:focus {
        outline: none;
        border-color: #a5b4fc;
        box-shadow: 0 0 0 3px rgba(165, 180, 252, 0.3);
    }

    .form-button {
        width: 100%;
        padding: 1rem;
        background: #4f46e5;
        color: white;
        border: none;
        border-radius: 10px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        margin-top: 0.5rem;
    }

    .form-button:hover {
        background: #4338ca;
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(79, 70, 229, 0.3);
    }

    .form-footer {
        text-align: center;
        margin-top: 1.5rem;
        color: #64748b;
        font-size: 0.95rem;
    }

    .form-footer a {
        color: #4f46e5;
        text-decoration: none;
        font-weight: 500;
    }

    .form-footer a:hover {
        text-decoration: underline;
    }

    .password-toggle {
        position: absolute;
        right: 15px;
        top: 42px;
        cursor: pointer;
        color: #94a3b8;
    }

    /* Responsive Design for Login Page */
    @media (max-width: 1024px) {
        .hero-section {
            padding: 3rem;
        }

        .hero-title {
            font-size: 2.5rem;
        }
    }

    @media (max-width: 768px) {
        .auth-container {
            flex-direction: column;
        }

        .hero-section {
            padding: 2rem;
            text-align: center;
        }

        .hero-content {
            max-width: 100%;
        }

        .feature-item {
            justify-content: center;
        }
    }

    @media (max-width: 480px) {
        .form-card {
            padding: 1.5rem;
        }

        .hero-title {
            font-size: 2rem;
        }
    }
  </style>
</head>
<body>

<!-- Top Navigation Bar -->
<div id="top-navbar" class="top-navbar hidden">
  <div class="logo">Course Registration</div>
  <div class="user-section">
    <span id="welcomeUser">Hi, User</span>
    <button class="logout-btn" onclick="logout()">Logout</button>
  </div>
</div>

<!-- Main Container -->
<div id="main-layout" class="main-container hidden">
  <!-- Sidebar -->
  <div class="sidebar">
    <div class="sidebar-section">
      <div class="sidebar-title">Navigation</div>
      <div class="sidebar-item active" onclick="showSection('available')">
        <span class="sidebar-item-icon">ðŸ“š</span>
        <span>Available Courses</span>
      </div>
      <div class="sidebar-item" onclick="showSection('opted')">
        <span class="sidebar-item-icon">âœ…</span>
        <span>Opted Courses</span>
      </div>
    </div>
  </div>

  <!-- Content Area -->
  <div class="content-area">
    <!-- Available Courses Section -->
    <div id="available-section">
      <div class="content-header">
        <div class="content-title">Available Elective Courses</div>
        <div class="content-subtitle">Browse and enroll in elective courses</div>
      </div>
      <div class="course-grid" id="courseCards">
        <div class="loading"></div>
      </div>
    </div>

    <!-- Opted Courses Section -->
    <div id="opted-section" class="hidden">
      <div class="content-header">
        <div class="content-title">Your Selected Course</div>
        <div class="content-subtitle">Manage your enrolled course</div>
      </div>
      <div class="course-grid" id="optedCards">
        <div class="loading"></div>
      </div>
    </div>
  </div>
</div>

<!-- Admin Dashboard -->
<div id="admin-dashboard" class="main-container hidden">
  <!-- Sidebar -->
  <div class="sidebar">
    <div class="sidebar-section">
      <div class="sidebar-title">Admin Panel</div>
      <div class="sidebar-item active" onclick="showAdminSection('courses')">
        <span class="sidebar-item-icon"><i class="fas fa-book"></i></span>
        <span>Manage Courses</span>
      </div>
      <div class="sidebar-item" onclick="showAdminSection('enrollments')">
        <span class="sidebar-item-icon"><i class="fas fa-users"></i></span>
        <span>Course Enrollments</span>
      </div>
      <div class="sidebar-item" onclick="showAdminSection('users')">
        <span class="sidebar-item-icon"><i class="fas fa-user"></i></span>
        <span>User Management</span>
      </div>
    </div>
  </div>

  <!-- Content Area -->
  <div class="content-area">
    <!-- Manage Courses Section -->
    <div id="admin-courses-section">
      <div class="content-header">
        <div class="content-title">Manage Courses</div>
        <div class="content-subtitle">Add, edit or remove available courses</div>
      </div>

      <div class="admin-dashboard">
        <div class="admin-section">
          <div class="admin-section-title">Add New Course</div>
          <form id="add-course-form" class="admin-form">
            <div class="form-group">
              <input type="text" id="course-code" class="form-input" placeholder="Course Code" required>
            </div>
            <div class="form-group">
              <input type="text" id="course-name" class="form-input" placeholder="Course Name" required>
            </div>
            <div class="form-group">
              <input type="text" id="course-description" class="form-input" placeholder="Description">
            </div>
            <div class="form-group">
              <input type="number" id="course-seats" class="form-input" placeholder="Available Seats" required>
            </div>
            <button type="submit" class="form-button admin-form-button">Add Course</button>
          </form>
        </div>

        <div class="admin-section">
          <div class="admin-section-title">Current Courses</div>
          <div class="course-grid" id="admin-course-cards">
            <div class="loading"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Course Enrollments Section -->
    <div id="admin-enrollments-section" class="hidden">
      <div class="content-header">
        <div class="content-title">Course Enrollments</div>
        <div class="content-subtitle">View and manage student enrollments</div>
      </div>

      <div class="admin-dashboard">
        <div class="admin-section">
          <div class="admin-section-title">Select Course</div>
          <select id="enrollment-course-select" class="form-input" onchange="loadCourseEnrollments()">
            <option value="">-- Select a course --</option>
          </select>
        </div>

        <div class="admin-section">
          <div class="admin-section-title">Enrolled Students</div>
          <div id="enrolled-students-container">
            <div class="empty-state">
              <h3>No Course Selected</h3>
              <p>Please select a course to view enrolled students.</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- User Management Section -->
    <div id="admin-users-section" class="hidden">
      <div class="content-header">
        <div class="content-title">User Management</div>
        <div class="content-subtitle">View and manage all registered users</div>
      </div>

      <div class="admin-dashboard">
        <div class="admin-section">
          <div class="admin-section-title">All Users</div>
          <div id="users-table-container">
            <table class="user-table">
              <thead>
              <tr>
                <th>Name</th>
                <th>Email</th>
                <th>Enrolled Course</th>
                <th>Actions</th>
              </tr>
              </thead>
              <tbody id="users-table-body">
              <tr>
                <td colspan="4" style="text-align: center;">
                  <div class="loading"></div>
                </td>
              </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- NEW LOGIN PAGE DESIGN (only this section changed visually) -->
<div id="auth-container" class="auth-container">
  <!-- Hero Section -->
  <div class="hero-section">
    <div class="hero-content">
      <h1 class="hero-title">Welcome to CourseHub</h1>
      <p class="hero-subtitle">Your gateway to academic excellence. Register for courses, track your progress, and achieve your educational goals.</p>

      <div class="features">
        <div class="feature-item">
          <div class="feature-icon">
            <i class="fas fa-book-open"></i>
          </div>
          <div class="feature-text">Browse hundreds of courses across all disciplines</div>
        </div>
        <div class="feature-item">
          <div class="feature-icon">
            <i class="fas fa-calendar-check"></i>
          </div>
          <div class="feature-text">Easy registration and schedule management</div>
        </div>
        <div class="feature-item">
          <div class="feature-icon">
            <i class="fas fa-chart-line"></i>
          </div>
          <div class="feature-text">Track your academic progress and achievements</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Forms Section -->
  <div class="forms-section">
    <!-- Registration Form -->
    <div id="registration-form" class="form-container">
      <div class="form-card">
        <h2 class="form-title">Create Account</h2>
        <p class="form-subtitle">Join thousands of students managing their courses with us</p>

        <div class="form-group">
          <label for="reg-name" class="form-label">Full Name</label>
          <input type="text" id="reg-name" class="form-input" placeholder="Enter your full name" required>
        </div>
        <div class="form-group">
          <label for="reg-email" class="form-label">Email Address</label>
          <input type="email" id="reg-email" class="form-input" placeholder="Enter your email" required>
        </div>
        <button class="form-button" onclick="registerStudent()">Create Account</button>
        <div class="form-footer">
          Already have an account? <a href="#" onclick="toggleForms('login')">Sign in here</a>
        </div>
      </div>
    </div>

    <!-- Login Form -->
    <div id="login-form" class="form-container hidden">
      <div class="form-card">
        <h2 class="form-title">Welcome Back</h2>
        <p class="form-subtitle">Sign in to access your courses and dashboard</p>

        <div class="login-type-toggle">
          <div class="login-type-btn active" id="student-login-btn" onclick="toggleLoginType('student')">Student</div>
          <div class="login-type-btn" id="admin-login-btn" onclick="toggleLoginType('admin')">Admin</div>
        </div>

        <div class="form-group">
          <label for="login-email" class="form-label" id="login-email-label">Email Address</label>
          <input type="email" id="login-email" class="form-input" placeholder="Enter your email" required>
        </div>
        <div class="form-group">
          <label for="login-password" class="form-label">Password</label>
          <input type="password" id="login-password" class="form-input" placeholder="Enter your password" required>
          <i class="far fa-eye password-toggle" id="togglePassword" onclick="togglePasswordVisibility()"></i>
        </div>
        <button class="form-button" onclick="login()">Sign In</button>
        <div class="form-footer">
          Don't have an account? <a href="#" onclick="toggleForms('register')">Create one here</a>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ORIGINAL JAVASCRIPT (completely unchanged) -->
<script>
  const BASE_URL = "http://localhost:8080";
  let isAdminLogin = false;

  // Check if user is already logged in on page load
  window.addEventListener('DOMContentLoaded', function() {
      const studentEmail = sessionStorage.getItem("studentEmail");
      const studentName = sessionStorage.getItem("studentName");
      const adminLoggedIn = sessionStorage.getItem("adminLoggedIn");

      if (studentEmail && studentName) {
          showLoggedInInterface(studentName);
      } else if (adminLoggedIn) {
          showAdminInterface();
      }
  });

  function toggleLoginType(type) {
      isAdminLogin = type === 'admin';
      document.getElementById('student-login-btn').classList.toggle('active', type === 'student');
      document.getElementById('admin-login-btn').classList.toggle('active', type === 'admin');

      // Update placeholder text
      const emailInput = document.getElementById('login-email');
      emailInput.placeholder = type === 'admin' ? 'Admin Username' : 'Email Address';
  }

  function showLoggedInInterface(studentName) {
      document.getElementById('auth-container').classList.add('hidden');
      document.getElementById('top-navbar').classList.remove('hidden');
      document.getElementById('main-layout').classList.remove('hidden');
      document.getElementById('admin-dashboard').classList.add('hidden');
      document.getElementById('welcomeUser').innerText = `Hi, ${studentName}`;
      showSection('available');
  }

  function showAdminInterface() {
      document.getElementById('auth-container').classList.add('hidden');
      document.getElementById('top-navbar').classList.remove('hidden');
      document.getElementById('main-layout').classList.add('hidden');
      document.getElementById('admin-dashboard').classList.remove('hidden');
      document.getElementById('welcomeUser').innerText = `Hi, Admin`;
      showAdminSection('courses');
      loadAdminCourses();
      loadAllUsers();
      populateCourseSelect();
  }

  function toggleForms(mode) {
      if (mode === 'login') {
          document.getElementById('registration-form').classList.add('hidden');
          document.getElementById('login-form').classList.remove('hidden');
      } else {
          document.getElementById('login-form').classList.add('hidden');
          document.getElementById('registration-form').classList.remove('hidden');
      }
  }

  function logout() {
      sessionStorage.clear();
      document.getElementById('top-navbar').classList.add('hidden');
      document.getElementById('main-layout').classList.add('hidden');
      document.getElementById('admin-dashboard').classList.add('hidden');
      document.getElementById('auth-container').classList.remove('hidden');
      document.getElementById('registration-form').classList.remove('hidden');
      document.getElementById('login-form').classList.add('hidden');
      isAdminLogin = false;

      // Clear form inputs
      document.getElementById('login-email').value = '';
      document.getElementById('login-password').value = '';
  }

  function showSection(type) {
      // Update sidebar active state
      document.querySelectorAll('.sidebar-item').forEach(item => {
          item.classList.remove('active');
      });

      if (type === 'available') {
          document.getElementById('available-section').classList.remove('hidden');
          document.getElementById('opted-section').classList.add('hidden');
          document.querySelectorAll('.sidebar-item')[0].classList.add('active');
          loadCourses();
      } else {
          document.getElementById('available-section').classList.add('hidden');
          document.getElementById('opted-section').classList.remove('hidden');
          document.querySelectorAll('.sidebar-item')[1].classList.add('active');
          loadOptedCourse();
      }
  }

  function showAdminSection(type) {
      // Update sidebar active state
      document.querySelectorAll('.sidebar-item').forEach(item => {
          item.classList.remove('active');
      });

      document.getElementById('admin-courses-section').classList.add('hidden');
      document.getElementById('admin-enrollments-section').classList.add('hidden');
      document.getElementById('admin-users-section').classList.add('hidden');

      if (type === 'courses') {
          document.getElementById('admin-courses-section').classList.remove('hidden');
          document.querySelectorAll('.sidebar-item')[0].classList.add('active');
      } else if (type === 'enrollments') {
          document.getElementById('admin-enrollments-section').classList.remove('hidden');
          document.querySelectorAll('.sidebar-item')[1].classList.add('active');
      } else if (type === 'users') {
          document.getElementById('admin-users-section').classList.remove('hidden');
          document.querySelectorAll('.sidebar-item')[2].classList.add('active');
      }
  }

  async function registerStudent() {
      const name = document.getElementById('reg-name').value.trim();
      const email = document.getElementById('reg-email').value.trim();

      if (!name || !email) {
          alert("Please enter both name and email.");
          return;
      }

      const button = event.target;
      const originalText = button.textContent;
      button.innerHTML = '<div class="loading"></div>';
      button.disabled = true;

      try {
          const res = await fetch(`${BASE_URL}/register-student`, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ name, email })
          });

          if (res.ok) {
              alert("Registered successfully! Check your email for the password.");
              toggleForms('login');
              document.getElementById('reg-name').value = '';
              document.getElementById('reg-email').value = '';
          } else {
              alert("Registration failed. Please try again.");
          }
      } catch (error) {
          alert("Network error. Please check your connection.");
      } finally {
          button.textContent = originalText;
          button.disabled = false;
      }
  }

  async function login() {
      const email = document.getElementById('login-email').value.trim();
      const password = document.getElementById('login-password').value.trim();

      if (!email || !password) {
          alert("Please enter both email and password.");
          return;
      }

      const button = event.target;
      const originalText = button.textContent;
      button.innerHTML = '<div class="loading"></div>';
      button.disabled = true;

      try {
          if (isAdminLogin) {
              // Admin login (hardcoded for demo)
              if (email === 'admin' && password === 'admin') {
                  sessionStorage.setItem("adminLoggedIn", "true");
                  showAdminInterface();
              } else {
                  alert("Invalid admin credentials");
              }
          } else {
              // Student login
              const res = await fetch(`${BASE_URL}/login`, {
                  method: 'POST',
                  headers: { 'Content-Type': 'application/json' },
                  body: JSON.stringify({ email, password })
              });

              if (res.ok) {
                  const student = await res.json();
                  sessionStorage.setItem("studentEmail", student.email);
                  sessionStorage.setItem("studentName", student.name);
                  showLoggedInInterface(student.name);
              } else {
                  const err = await res.json();
                  alert(err.error || "Login failed. Please check your credentials.");
              }
          }
      } catch (error) {
          alert("Network error. Please check your connection.");
      } finally {
          button.textContent = originalText;
          button.disabled = false;
      }
  }

  function togglePasswordVisibility() {
      const passwordInput = document.getElementById('login-password');
      const toggleIcon = document.getElementById('togglePassword');

      if (passwordInput.type === 'password') {
          passwordInput.type = 'text';
          toggleIcon.classList.remove('fa-eye');
          toggleIcon.classList.add('fa-eye-slash');
      } else {
          passwordInput.type = 'password';
          toggleIcon.classList.remove('fa-eye-slash');
          toggleIcon.classList.add('fa-eye');
      }
  }

  async function loadCourses() {
      const container = document.getElementById("courseCards");
      container.innerHTML = '<div class="loading"></div>';

      try {
          const res = await fetch(`${BASE_URL}/courses`);
          const courses = await res.json();

          container.innerHTML = "";

          if (courses.length === 0) {
              container.innerHTML = `
                  <div class="empty-state">
                      <h3>No Courses Available</h3>
                      <p>There are currently no elective courses available for registration.</p>
                  </div>
              `;
              return;
          }

          courses.forEach(course => {
              const card = document.createElement("div");
              card.className = "course-card";

              const isAvailable = course.seatsAvailable > 0;
              const buttonClass = isAvailable ? 'available' : 'unavailable';
              const buttonText = isAvailable ? 'Enroll Now' : 'Course Full';
              const buttonAction = isAvailable ? `chooseCourse('${course.courseCode}')` : '';

              card.innerHTML = `
                  <div class="course-code">${course.courseCode}</div>
                  <div class="course-name">${course.courseName}</div>
                  <div class="course-description">${course.description || 'Enhance your skills with this comprehensive elective course designed to provide practical knowledge and industry-relevant expertise.'}</div>
                  <div class="seats-info">
                      <span class="${isAvailable ? 'seats-available' : 'seats-full'}">
                          ${isAvailable ? `${course.seatsAvailable} seats available` : 'No seats available'}
                      </span>
                  </div>
                  <button class="course-button ${buttonClass}"
                          ${isAvailable ? `onclick="${buttonAction}"` : 'disabled'}>
                      ${buttonText}
                  </button>
              `;
              container.appendChild(card);
          });
      } catch (error) {
          container.innerHTML = `
              <div class="empty-state">
                  <h3>Error Loading Courses</h3>
                  <p>Unable to load courses. Please try again later.</p>
              </div>
          `;
      }
  }

  async function chooseCourse(courseCode) {
      const email = sessionStorage.getItem("studentEmail");

      if (!email) {
          alert("Session expired. Please login again.");
          logout();
          return;
      }

      try {
          const res = await fetch(`${BASE_URL}/register-course`, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ email, courseCode })
          });

          const result = await res.json();
          if (res.ok) {
              alert(result.message);
              loadCourses();
              loadOptedCourse();
          } else {
              alert(result.error);
          }
      } catch (error) {
          alert("Network error. Please try again.");
      }
  }

  async function loadOptedCourse() {
      const email = sessionStorage.getItem("studentEmail");
      const container = document.getElementById("optedCards");
      container.innerHTML = '<div class="loading"></div>';

      if (!email) {
          alert("Session expired. Please login again.");
          logout();
          return;
      }

      try {
          const res = await fetch(`${BASE_URL}/student?email=${email}`);
          const student = await res.json();

          container.innerHTML = "";

          if (student.selectedCourse) {
              const res2 = await fetch(`${BASE_URL}/courses`);
              const allCourses = await res2.json();
              const course = allCourses.find(c => c.courseCode === student.selectedCourse);

              if (course) {
                  const card = document.createElement("div");
                  card.className = "course-card";
                  card.innerHTML = `
                      <div class="course-code">${course.courseCode}</div>
                      <div class="course-name">${course.courseName}</div>
                      <div class="course-description">${course.description || 'You have successfully enrolled in this course. Check your email for further instructions.'}</div>
                      <div class="seats-info">
                          <span class="seats-available">
                              ${course.seatsAvailable} seats remaining
                          </span>
                      </div>
                      <div class="enrolled-badge">
                          âœ“ Enrolled Successfully
                      </div>
                  `;
                  container.appendChild(card);
              } else {
                  container.innerHTML = `
                      <div class="empty-state">
                          <h3>Course Not Found</h3>
                          <p>The selected course is no longer available in the system.</p>
                      </div>
                  `;
              }
          } else {
              container.innerHTML = `
                  <div class="empty-state">
                      <h3>No Course Selected</h3>
                      <p>You haven't enrolled in any elective course yet. Browse available courses to get started.</p>
                  </div>
              `;
          }
      } catch (error) {
          container.innerHTML = `
              <div class="empty-state">
                  <h3>Error Loading Data</h3>
                  <p>Unable to load your course information. Please try again later.</p>
              </div>
          `;
      }
  }

  // Admin Functions
  async function loadAdminCourses() {
      const container = document.getElementById("admin-course-cards");
      container.innerHTML = '<div class="loading"></div>';

      try {
          const res = await fetch(`${BASE_URL}/courses`);
          const courses = await res.json();

          container.innerHTML = "";

          if (courses.length === 0) {
              container.innerHTML = `
                  <div class="empty-state">
                      <h3>No Courses Available</h3>
                      <p>There are currently no courses in the system.</p>
                  </div>
              `;
              return;
          }

          courses.forEach(course => {
              const card = document.createElement("div");
              card.className = "course-card";
              card.innerHTML = `
                  <div class="course-code">${course.courseCode}</div>
                  <div class="course-name">${course.courseName}</div>
                  <div class="course-description">${course.description || 'No description provided.'}</div>
                  <div class="seats-info">
                      <span class="${course.seatsAvailable > 0 ? 'seats-available' : 'seats-full'}">
                          ${course.seatsAvailable > 0 ? `${course.seatsAvailable} seats available` : 'No seats available'}
                      </span>
                  </div>
                  <button class="course-button available" onclick="deleteCourse('${course.courseCode}')">
                      Delete Course
                  </button>
              `;
              container.appendChild(card);
          });
      } catch (error) {
          container.innerHTML = `
              <div class="empty-state">
                  <h3>Error Loading Courses</h3>
                  <p>Unable to load courses. Please try again later.</p>
              </div>
          `;
      }
  }

  async function deleteCourse(courseCode) {
      if (!confirm(`Are you sure you want to delete course ${courseCode}? This will also remove all enrollments.`)) {
          return;
      }

      try {
          const res = await fetch(`${BASE_URL}/courses/${courseCode}`, {
              method: 'DELETE'
          });

          if (res.ok) {
              alert("Course deleted successfully");
              loadAdminCourses();
              populateCourseSelect();
          } else {
              const err = await res.json();
              alert(err.error || "Failed to delete course");
          }
      } catch (error) {
          alert("Network error. Please try again.");
      }
  }

  async function populateCourseSelect() {
      const select = document.getElementById("enrollment-course-select");
      select.innerHTML = '<option value="">-- Select a course --</option>';

      try {
          const res = await fetch(`${BASE_URL}/courses`);
          const courses = await res.json();

          courses.forEach(course => {
              const option = document.createElement("option");
              option.value = course.courseCode;
              option.textContent = `${course.courseCode} - ${course.courseName}`;
              select.appendChild(option);
          });
      } catch (error) {
          console.error("Error loading courses:", error);
      }
  }

  async function loadCourseEnrollments() {
      const courseCode = document.getElementById("enrollment-course-select").value;
      const container = document.getElementById("enrolled-students-container");

      if (!courseCode) {
          container.innerHTML = `
              <div class="empty-state">
                  <h3>No Course Selected</h3>
                  <p>Please select a course to view enrolled students.</p>
              </div>
          `;
          return;
      }

      container.innerHTML = '<div class="loading"></div>';

      try {
          const res = await fetch(`${BASE_URL}/course-enrollments?courseCode=${courseCode}`);
          const enrollments = await res.json();

          if (enrollments.length === 0) {
              container.innerHTML = `
                  <div class="empty-state">
                      <h3>No Enrollments</h3>
                      <p>No students have enrolled in this course yet.</p>
                  </div>
              `;
              return;
          }

          let html = `
              <table class="user-table">
                  <thead>
                      <tr>
                          <th>Student Name</th>
                          <th>Email</th>
                          <th>Actions</th>
                      </tr>
                  </thead>
                  <tbody>
          `;

          enrollments.forEach(student => {
              html += `
                  <tr>
                      <td>${student.name}</td>
                      <td>${student.email}</td>
                      <td>
                          <button class="action-button delete" onclick="removeFromCourse('${courseCode}', '${student.email}')">
                              Remove
                          </button>
                      </td>
                  </tr>
              `;
          });

          html += `
                  </tbody>
              </table>
          `;

          container.innerHTML = html;
      } catch (error) {
          container.innerHTML = `
              <div class="empty-state">
                  <h3>Error Loading Enrollments</h3>
                  <p>Unable to load student enrollments. Please try again later.</p>
              </div>
          `;
      }
  }

  async function removeFromCourse(courseCode, studentEmail) {
      if (!confirm(`Are you sure you want to remove this student from the course?`)) {
          return;
      }

      try {
          const res = await fetch(`${BASE_URL}/remove-enrollment`, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ courseCode, studentEmail })
          });

          if (res.ok) {
              alert("Student removed from course successfully");
              loadCourseEnrollments();
          } else {
              const err = await res.json();
              alert(err.error || "Failed to remove student from course");
          }
      } catch (error) {
          alert("Network error. Please try again.");
      }
  }

  async function loadAllUsers() {
      const container = document.getElementById("users-table-body");
      container.innerHTML = '<tr><td colspan="4" style="text-align: center;"><div class="loading"></div></td></tr>';

      try {
          const res = await fetch(`${BASE_URL}/students`);
          const students = await res.json();

          container.innerHTML = "";

          if (students.length === 0) {
              container.innerHTML = `
                  <tr>
                      <td colspan="4" style="text-align: center;">
                          <div class="empty-state">
                              <h3>No Users Found</h3>
                              <p>There are currently no registered users in the system.</p>
                          </div>
                      </td>
                  </tr>
              `;
              return;
          }

          students.forEach(student => {
              const row = document.createElement("tr");
              row.innerHTML = `
                  <td>${student.name}</td>
                  <td>${student.email}</td>
                  <td>${student.selectedCourse || 'None'}</td>
                  <td>
                      <button class="action-button view" onclick="viewUserDetails('${student.email}')">
                          View
                      </button>
                      <button class="action-button delete" onclick="deleteUser('${student.email}')">
                          Delete
                      </button>
                  </td>
              `;
              container.appendChild(row);
          });
      } catch (error) {
          container.innerHTML = `
              <tr>
                  <td colspan="4" style="text-align: center;">
                      <div class="empty-state">
                          <h3>Error Loading Users</h3>
                          <p>Unable to load user data. Please try again later.</p>
                      </div>
                  </td>
              </tr>
          `;
      }
  }

  function viewUserDetails(email) {
      alert(`View details for user: ${email}\nThis would show more detailed user information in a real application.`);
  }

  async function deleteUser(email) {
      if (!confirm(`Are you sure you want to delete user ${email}? This action cannot be undone.`)) {
          return;
      }

      try {
          const res = await fetch(`${BASE_URL}/students/${email}`, {
              method: 'DELETE'
          });

          if (res.ok) {
              alert("User deleted successfully");
              loadAllUsers();
          } else {
              const err = await res.json();
              alert(err.error || "Failed to delete user");
          }
      } catch (error) {
          alert("Network error. Please try again.");
      }
  }

  // Handle add course form submission
  document.getElementById('add-course-form').addEventListener('submit', async function(e) {
      e.preventDefault();

      const courseCode = document.getElementById('course-code').value.trim();
      const courseName = document.getElementById('course-name').value.trim();
      const description = document.getElementById('course-description').value.trim();
      const seats = document.getElementById('course-seats').value.trim();

      if (!courseCode || !courseName || !seats) {
          alert("Please fill in all required fields");
          return;
      }

      const button = this.querySelector('button[type="submit"]');
      const originalText = button.textContent;
      button.innerHTML = '<div class="loading"></div>';
      button.disabled = true;

      try {
          const res = await fetch(`${BASE_URL}/courses`, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({
                  courseCode,
                  courseName,
                  description,
                  seatsAvailable: parseInt(seats)
              })
          });

          if (res.ok) {
              alert("Course added successfully");
              this.reset();
              loadAdminCourses();
              populateCourseSelect();
          } else {
              const err = await res.json();
              alert(err.error || "Failed to add course");
          }
      } catch (error) {
          alert("Network error. Please try again.");
      } finally {
          button.textContent = originalText;
          button.disabled = false;
      }
  });
</script>
</body>
</html>
